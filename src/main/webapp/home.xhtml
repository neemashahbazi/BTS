<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:sec="http://www.springframework.org/security/tags">

<h:head>
    <title>BTS: Trader Home</title>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <h:outputStylesheet library="css" name="style.css"/>
    <h:outputStylesheet library="css" name="bootstrap.min.css"/>
    <h:outputStylesheet library="js" name="bootstrap.min.js"/>
    <h:outputStylesheet library="js" name="popper.min.js"/>
    <h:outputStylesheet library="js" name="jquery-3.3.1.slim.min.js"/>
</h:head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">

            <h1 class="text-center">BTS<i style="margin: 5px"
                                          class="fa fa-bitcoin"></i>: Trader Home</h1>


            <h:form>
                <sec:authorize access="hasAuthority('CLIENT')">

                <h:commandLink style="margin-right: 30px ; font-size: 25px" value="History"><i style="margin: 5px"
                                                                                               class="fa fa-history"></i>
                </h:commandLink>
                </sec:authorize>
                <sec:authorize access="hasAuthority('TRADER')">

                    <h:commandLink style=" margin-right: 30px ;font-size: 25px" value="Search"><i style="margin: 5px "
                                                                                                  class="fa fa-search"></i>
                    </h:commandLink>
                </sec:authorize>
                <sec:authorize access="hasAuthority('CLIENT')">


                    <h:commandLink style="margin-right: 30px ; font-size: 25px" value="Buy Bitcoin"><i
                            style="margin: 5px"
                            class="fa fa-cart-plus"></i>
                    </h:commandLink>
                </sec:authorize>
                <sec:authorize access="hasAuthority('CLIENT')">

                    <h:commandLink style="margin-right: 30px ; font-size: 25px" value="Sell Bitcoin"><i
                            style="margin: 5px"
                            class="fa fa-handshake-o"></i>
                    </h:commandLink>
                </sec:authorize>
                <sec:authorize access="hasAuthority('CLIENT')">

                    <h:commandLink style="margin-right: 30px ; font-size: 25px" value="Add To Balance"><i
                            style="margin: 5px"
                            class="fa fa-dollar"></i>
                    </h:commandLink>
                </sec:authorize>
                <h:outputLink style="margin-right: 30px ; font-size: 25px"
                              value="#{request.contextPath}/logout">Logout<i
                        style="margin: 5px"
                        class="fa fa-close"></i>
                </h:outputLink>
            </h:form>
            <br></br>

            <h2 class="text-center">Current Bitcoin Price <span class="badge badge-success"
                                                                id="bitcoin-data">
            </span><h:link onclick="parseJson();"
                           style="margin-left: 5px ; font-size: 30px" value=""><i style="margin: 2px"
                                                                                  class="fa fa-refresh"></i>
            </h:link></h2>

            <sec:authorize access="hasAuthority('TRADER')">


                <h2>Client List:</h2>
                <h:dataTable styleClass="table table-striped" var="client"
                             value="#{traderView.getAllClientsByTrader()}">

                    <h:column>
                        <f:facet name="header">ID</f:facet>#{client.id}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Name</f:facet>#{client.firstname}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Last Name</f:facet>#{client.lastname}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Cell Phone Number</f:facet>#{client.cellphone_num}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Phone Number</f:facet>#{client.phone_num}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Email</f:facet>#{client.email}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Address</f:facet>#{client.street}, #{client.zipcode}, #{client.city}, #{client.state}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Level</f:facet>#{client.level}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Balance</f:facet>#{client.bitcoin_bal} <i class="fa fa-bitcoin"></i>
                    </h:column>
                    <h:column>
                        <f:facet name="header">Fiat Currency</f:facet>#{client.fiat_currency} <i class="fa fa-dollar"></i>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Actions</f:facet>
                        <h:commandButton type="button" style="margin: 1px 1px 1px 1px"
                                         styleClass="btn btn-primary btn-sm"
                                         value="Buy"/>
                        <h:commandButton type="button" style="margin: 1px 1px 1px 1px"
                                         styleClass="btn btn-success btn-sm"
                                         value="Sell"/>
                        <h:commandButton type="button" style="margin: 1px 1px 1px 1px" styleClass="btn btn-danger btn-sm"
                                         value="History"/>
                        <h:commandButton type="button" style="margin: 1px 1px 1px 1px"
                                         styleClass="btn btn-warning btn-sm"
                                         value="Transactions"/>
                    </h:column>
                </h:dataTable>

            </sec:authorize>

            <sec:authorize access="hasAuthority('CLIENT')">

            <h2>Transactions:</h2>
            <h:dataTable styleClass="table table-striped" var="history">

                <h:column>
                    <f:facet name="header">Transaction ID</f:facet>
                </h:column>

                <h:column>
                    <f:facet name="header">Transaction Type</f:facet>
                </h:column>

                <h:column>
                    <f:facet name="header">Amount</f:facet>
                </h:column>

                <h:column>
                    <f:facet name="header">Date</f:facet>

                </h:column>

                <h:column>
                    <f:facet name="header">Commission Type</f:facet>
                </h:column>

                <h:column>
                    <f:facet name="header">Commission Amount</f:facet>
                </h:column>
                <h:column>
                    <f:facet name="header">Actions</f:facet>
                    <h:commandButton type="button" style="margin: 1px 1px 1px 1px"
                                     styleClass="btn btn-danger btn-sm"
                                     value="Cancel Transaction"/>
                </h:column>

            </h:dataTable>
            </sec:authorize>
        </div>
    </div>
</div>
<script type="text/javascript">
    var xmlhttp = new XMLHttpRequest();
    var url = "https://api.coindesk.com/v1/bpi/currentprice.json";

    xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 &amp;&amp; this.status == 200) {
            var json = JSON.parse(this.responseText);
            parseJson(json);
        }
    };

    xmlhttp.open("GET", url, true);
    xmlhttp.send();

    function parseJson(json) {
        var usdValue = " $" + json["bpi"]["USD"]["rate"];
        document.getElementById("bitcoin-data").innerHTML =
            usdValue;
    }

</script>
</body>
</html>




